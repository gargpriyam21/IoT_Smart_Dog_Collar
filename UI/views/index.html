<!DOCTYPE html>
<html>
  <head>
    <style>
      body {
        margin: 0;
        padding: 0;
      }
    </style>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript"></script>
	<script>
		var pathPoints = [];
		
		// called when the client connects
		function onConnect() {
		  // Once a connection has been made, make a subscription and send a message.
		  console.log("onConnect");
		  client.subscribe("pathPoints");
		  message = new Paho.MQTT.Message("WebUI - Online");
		  message.destinationName = "status";
		  client.send(message);
		}

		// called when the client loses its connection
		function onConnectionLost(responseObject) {
		  if (responseObject.errorCode !== 0) {
			console.log("onConnectionLost:"+responseObject.errorMessage);
		  }
		}

		// called when a message arrives
		function onMessageArrived(message) {
			var payload = message.payloadString;
			console.log("onMessageArrived:" + payload);
			pathPoints.push(payload);
			let list = document.getElementById("pointsList");
			let listItem = document.createElement("li");
			listItem.innerText = payload;
			list.appendChild(listItem);
			plotPoint(payload,payload);
		}
		
		function MQTTStart() {
		// Create a client instance
		client = new Paho.MQTT.Client("localhost", Number(9001), "webUI");

		// set callback handlers
		client.onConnectionLost = onConnectionLost;
		client.onMessageArrived = onMessageArrived;

		// connect the client
		client.connect({onSuccess:onConnect});
		}
    </script>
	<script>
		function plotPoint(xVar,yVar){
			const canvas = document.getElementById('myCanvas');
			const context = canvas.getContext('2d');
			const x = xVar;
			const y = yVar;
			const radius = 5;
			
			context.beginPath();
			context.arc(x, y, radius, 0, 2 * Math.PI, false);
			context.fillStyle = 'red';
			context.fill();
			context.lineWidth = 3;
			context.strokeStyle = 'black';
			context.stroke();
		}
	</script>
  </head>
  <body>
    <h1>
      Smart Dog Collar UI
    </h1>
    <h2>
	Path:
    </h2>
	<script>
		MQTTStart();
	</script>
    <canvas id="myCanvas" width="700" height="400"></canvas>
	<script>
		const canvas = document.getElementById('myCanvas');
		const context = canvas.getContext('2d');

		context.beginPath();
		context.rect(0, 0, canvas.width, canvas.height);
		context.stroke();
	</script>
	<h2>
	Points:
	</h2>
	<ol id="pointsList"></ol>
  </body>
</html>      